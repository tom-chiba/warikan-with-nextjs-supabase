---
description: TDDドキュメント作成フェーズ - ADRを作成して設計判断を記録する
argument-hint: [実装した機能]
---

# TDD ドキュメント作成フェーズ

**目的**: $ARGUMENTS

## タスク

実装した機能について、重要な設計判断をADR（Architecture Decision Records）として記録してください。

### ADRを作成すべき判断基準

以下のような設計判断があった場合、ADRの作成を検討してください：

- **技術選択**: ライブラリ・フレームワークの選定理由
- **アーキテクチャパターン**: 採用した設計パターンとその理由
- **データモデル設計**: テーブル構造・型定義の設計判断
- **トレードオフ**: パフォーマンス vs 可読性などの判断
- **制約事項**: 既知の制約や技術的負債の記録
- **代替案の検討**: 検討したが採用しなかった選択肢とその理由

### ADRを作成しない場合

以下の場合はADRを作成する必要はありません：

- 既存のパターンに従っただけの実装
- 自明な実装（他に選択肢がない）
- 小さなバグ修正やリファクタリング

### ADRファイル構成

ADRは `docs/adr/` ディレクトリに作成します：

```
docs/adr/
├── 0001-record-architecture-decisions.md（このファイルは最初に作成）
├── 0002-use-tanstack-query-for-state.md
└── 0003-implement-random-remainder-distribution.md
```

### ADRテンプレート

以下のテンプレートに従ってADRを作成してください：

```markdown
# [番号]. [タイトル]

日付: YYYY-MM-DD

## ステータス

[Accepted | Deprecated | Superseded]

## コンテキスト

何が問題だったのか、どのような状況で判断が必要になったのかを説明します。

## 決定

どのような判断を下したのかを明確に記述します。

## 理由

なぜその判断をしたのか、考慮した要素を説明します。

## 結果

この判断による影響（良い面・悪い面）を記述します。

### 良い影響

- ...

### 悪い影響・トレードオフ

- ...

## 代替案

検討したが採用しなかった選択肢とその理由。

## 関連する決定

関連するADRがあれば参照します。
```

### ADR作成手順

1. **最新のADR番号を確認**
   ```bash
   ls docs/adr/
   ```

2. **ADRファイルを作成**
   - ファイル名: `docs/adr/XXXX-short-title.md`
   - 番号は4桁でゼロパディング（例: 0001, 0002）
   - タイトルはケバブケース

3. **テンプレートに従って記述**
   - 簡潔に、しかし必要な情報は省略しない
   - 将来の自分や他の開発者が理解できるように書く
   - 技術的な詳細より「なぜ」を重視

4. **レビュー**
   - 記述内容が明確か確認
   - 誤字脱字チェック
   - 必要に応じてコードへのリンクを追加

### 例: 端数処理アルゴリズムのADR

```markdown
# 0003. 割り勘計算で端数をランダム配分する

日付: 2025-10-04

## ステータス

Accepted

## コンテキスト

割り勘計算時、支払額がメンバー数で割り切れない場合、端数（余り）の配分方法を決定する必要があった。

例: 100円を3人で割る場合、33円×3人=99円となり1円の端数が発生する。

## 決定

端数をランダムにメンバーに1円ずつ配分するアルゴリズムを採用した。

実装: `app/(authenticated)/_hooks/usePurchaseForm.ts:183-204`

## 理由

1. **公平性**: ランダム配分により長期的には各メンバーの負担が均等になる
2. **シンプル**: 実装がシンプルで理解しやすい
3. **ユーザー体験**: 誰が多く払うかが毎回変わるため、不公平感を軽減

## 結果

### 良い影響

- 端数処理ロジックが明確
- テストが書きやすい
- ユーザーからの不公平感のクレームがない

### 悪い影響・トレードオフ

- ランダム性により結果が毎回変わる（再現性がない）
- 同じ入力でも異なる結果になるため、テストが若干複雑

## 代替案

1. **最初のメンバーに全端数を配分**: シンプルだが不公平
2. **特定の優先順位で配分**: 公平だがルールが複雑
3. **端数を切り捨て**: 金額が合わなくなる

## 関連する決定

なし
```

## 完了チェックリスト

- [ ] ADR作成が必要な設計判断があったか確認した
- [ ] ADRファイルを作成した（必要な場合）
- [ ] テンプレートに従って記述した
- [ ] コードへのリンクや参照を追加した
- [ ] レビューして内容が明確か確認した

**次のステップ**: ADRの作成が完了したら、TDDサイクル完了です。必要に応じてコミットしてください。
